<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شركة GASTS | فخامة الإعلان</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />

    <style>
        /* ===== نفس CSS حقك بدون تغيير ===== */
        :root {
            --gold: #d4af37;
            --gold-light: #f9e272;
            --dark: #05080a;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(212, 175, 55, 0.2);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0;
            font-family: 'Cairo', sans-serif;
            background-color: var(--dark);
            color: #fff;
        }
        /* (اختصار: بقية CSS نفسه بالضبط) */
    </style>
</head>

<body>

<button id="authBtn">تسجيل دخول</button>

<!-- مودال تسجيل الدخول -->
<div id="authModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);align-items:center;justify-content:center;z-index:9999">
  <div class="auth-box" id="authBox">
    <h3 style="color:var(--gold)">تسجيل الدخول</h3>
    <input id="email" type="email" placeholder="البريد الإلكتروني">
    <input id="password" type="password" placeholder="كلمة المرور">
    <button id="loginBtn">دخول آمن</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ========== Supabase ========== */
const supabaseUrl = "https://hdyqcgsrjnciamsyeyla.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

function clean(input) {
    return String(input || "").replace(/[<>"'(){};]/g, "").trim();
}

/* ===== الدالة الصحيحة (بدون تكرار) ===== */
async function loginOrSignup(email, password) {
    email = clean(email);
    password = clean(password);

    if (!email || !password) return { error: "empty" };

    const { error } =
        await supabaseClient.auth.signInWithPassword({ email, password });

    if (error) {
        const { error: signUpError } =
            await supabaseClient.auth.signUp({ email, password });
        if (signUpError) return { error: signUpError.message };
    }

    return { success: true };
}

document.addEventListener("DOMContentLoaded", () => {
    const authBtn   = document.getElementById("authBtn");
    const authModal = document.getElementById("authModal");
    const loginBtn  = document.getElementById("loginBtn");
    const authBox   = document.getElementById("authBox");
    const emailInp  = document.getElementById("email");
    const passInp   = document.getElementById("password");

    authBtn.onclick = () => {
        authModal.style.display = "flex";
        emailInp.focus();
    };

    authModal.onclick = (e) => {
        if (e.target === authModal) authModal.style.display = "none";
    };

    /* ===== الحل النهائي ===== */
    async function handleLogin() {
        const email = emailInp.value;
        const password = passInp.value;

        const result = await loginOrSignup(email, password);

        if (result.error) {
            authBox.classList.add("shake");
            setTimeout(() => authBox.classList.remove("shake"), 300);
            return;
        }

        authModal.style.display = "none";
        window.location.href = "account.html";
    }

    loginBtn.onclick = handleLogin;

    document.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && authModal.style.display === "flex") {
            handleLogin();
        }
    });
});
</script>

<style>
@keyframes shake {
  0%,100% { transform: translateX(0); }
  25% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
}
</style>

</body>
</html>
