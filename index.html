<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GASTS | Ø§Ù„ÙØ®Ø§Ù…Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --dark: #05080a; --border: rgba(212, 175, 55, 0.2); }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { margin: 0; background: var(--dark); color: #fff; min-height: 100vh; overflow-x: hidden; text-align: center; }
        
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ù„ÙˆÙ‚Ùˆ */
        .nebula { position: fixed; inset: 0; z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); }
        header { padding: 60px 20px 20px; }
        .logo { font-size: 70px; font-weight: 900; background: linear-gradient(#fff, var(--gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        
        .verification { display: inline-flex; align-items: center; gap: 8px; background: rgba(212,175,55,0.1); padding: 6px 15px; border-radius: 20px; border: 1px solid var(--border); font-size: 11px; color: var(--gold); margin-bottom: 30px; }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        #userBox { position: fixed; top: 15px; right: 15px; display: none; align-items: center; gap: 10px; background: rgba(0,0,0,0.7); padding: 5px 12px; border-radius: 40px; border: 1px solid var(--border); z-index: 1001; backdrop-filter: blur(10px); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .btn-action { background: #fff; color: #000; padding: 15px 40px; border-radius: 50px; font-weight: 800; width: 260px; cursor: pointer; border: none; margin: 10px auto; display: block; transition: 0.3s; }
        .btn-gold { background: var(--gold); color: #000; font-weight: 900; border: none; padding: 12px; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-outline { background: transparent; color: var(--gold); border: 1px solid var(--gold); padding: 12px; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: 900; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© */
        .ad-box { width: 90%; max-width: 500px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin: 40px auto; backdrop-filter: blur(15px); }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:9999; align-items:center; justify-content:center; padding: 20px; }
        .modal-content { background:#0b0f14; border: 1px solid var(--border); padding: 30px; border-radius: 25px; width: 100%; max-width: 380px; }
        input, select, textarea { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: #1a1f26; color: white; outline: none; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¸Ø± */
        #spamLayer { display: none; position: fixed; inset: 0; background: #000; z-index: 10002; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="nebula"></div>

    <div id="spamLayer">
        <h1 style="color:var(--gold)">âš ï¸ ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠØ¯</h1>
        <p>Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø© Ø®Ø§Ø·Ø¦Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 30 Ø¯Ù‚ÙŠÙ‚Ø©.</p>
        <button class="btn-action" onclick="location.reload()">ØªØ­Ø¯ÙŠØ«</button>
    </div>

    <div id="userBox" onclick="openUserOptions()">
        <img id="headAvatar" src="" width="35" height="35" style="border-radius:50%; object-fit: cover;">
        <span id="headName" style="font-size: 13px;"></span>
    </div>

    <header>
        <h1 class="logo">GASTS</h1>
        <div class="verification">ğŸ‡¸ğŸ‡¦ ÙˆØ«ÙŠÙ‚Ø© Ø¹Ù…Ù„ Ø­Ø± Ù…Ø¹ØªÙ…Ø¯Ø©: FL-28491035</div>
    </header>

    <div id="mainUI">
        <button id="authBtn" class="btn-action" onclick="toggleModal('authModal', true)">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ / Ø§Ù†Ø¶Ù…Ø§Ù…</button>
        <button id="adBtn" class="btn-action" style="display:none; background:var(--gold);" onclick="toggleModal('adModal', true)">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
        
        <div class="ad-box">
            <h3 style="color:var(--gold); margin-top:0;">ÙˆØ§Ø¬Ù‡Ø© Ù‚Ø§Ø³ØªØ³ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</h3>
            <p style="font-size: 13px; opacity: 0.7; line-height: 1.6;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ÙØ§Ø®Ø±Ø© Ù„Ø¹Ø§Ù… 2026. Ø§Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø§Ù„Ø¢Ù† Ù„ÙŠØµÙ„ Ø¥Ù„Ù‰ Ù†Ø®Ø¨Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹.</p>
        </div>

        <div style="margin-top:20px; font-size: 12px; opacity: 0.5;">
            âœ‰ï¸ info@gasts.sa | ğŸ“± TikTok: @gasts
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold)">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØµÙˆÙ„</h3>
            <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn-gold" onclick="handleAuth('in')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
            <button class="btn-outline" onclick="handleAuth('up')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            <p onclick="toggleModal('authModal', false)" style="cursor:pointer; opacity:0.5; font-size:12px; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</p>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold)">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ GASTS</h3>
            <p style="font-size:12px; opacity:0.7;">ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            <input id="nick" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…">
            <input id="avatar" type="file" accept="image/*">
            <button class="btn-gold" onclick="updateProfile()">Ø­ÙØ¸ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</button>
            <p id="upStatus" style="font-size:11px; margin-top:10px;"></p>
        </div>
    </div>

    <div id="optionsModal" class="modal">
        <div class="modal-content">
            <h3 id="optTitle" style="color:var(--gold)">Ø®ÙŠØ§Ø±Ø§ØªÙŠ</h3>
            <button class="btn-gold" style="background:#fff" onclick="toggleModal('optionsModal', false); toggleModal('profileModal', true)">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
            <button class="btn-gold" style="background:#ff4444; color:#fff" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            <p onclick="toggleModal('optionsModal', false)" style="cursor:pointer; opacity:0.5; font-size:12px; margin-top:15px;">ØªØ±Ø§Ø¬Ø¹</p>
        </div>
    </div>

    <div id="adModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold)">Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
            <select id="cat"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option><option>Ø³ÙŠØ§Ø±Ø§Øª</option><option>Ø¹Ù‚Ø§Ø±Ø§Øª</option></select>
            <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
            <textarea id="desc" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..." style="height:80px;"></textarea>
            <button class="btn-gold" onclick="sendAd()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            <p onclick="toggleModal('adModal', false)" style="cursor:pointer; opacity:0.5; font-size:12px; margin-top:15px;">Ø¥Ù„ØºØ§Ø¡</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const client = window.supabase.createClient("https://hdyqcgsrjnciamsyeyla.supabase.co", "sb_publishable_tlwDSDSqkIpBdKGe_oA4Gg_twuI4nJC");
        let user = null;
        let tries = 0;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø±
        if(localStorage.getItem('g_block') > Date.now()) document.getElementById('spamLayer').style.display='flex';

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        client.auth.onAuthStateChange((event, session) => {
            if(session) {
                user = session.user;
                refreshUI();
            }
        });

        async function handleAuth(type) {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            if(!e || !p) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            const { data, error } = (type === 'in') 
                ? await client.auth.signInWithPassword({email:e, password:p})
                : await client.auth.signUp({email:e, password:p});

            if(error) {
                tries++;
                if(tries >= 5) { localStorage.setItem('g_block', Date.now() + 1800000); location.reload(); }
                return alert(error.message);
            }
            if(type === 'up') alert("ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡! Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
            toggleModal('authModal', false);
        }

        async function refreshUI() {
            if(!user) return;
            document.getElementById('authBtn').style.display = 'none';
            document.getElementById('adBtn').style.display = 'block';

            const { data: prof } = await client.from('profiles').select('*').eq('id', user.id).single();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯Ø§Ù‹ ØªÙ…Ø§Ù…Ø§Ù‹ Ø£Ùˆ Ù„Ù… ÙŠÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
            if(!prof || prof.username === user.email.split('@')[0]) {
                toggleModal('profileModal', true);
            } else {
                document.getElementById('headName').innerText = prof.username;
                document.getElementById('headAvatar').src = prof.avatar_url || 'https://i.imgur.com/8Km9tLL.png';
                document.getElementById('userBox').style.display = 'flex';
                document.getElementById('optTitle').innerText = prof.username;
            }
        }

        async function updateProfile() {
            const name = document.getElementById('nick').value;
            const file = document.getElementById('avatar').files[0];
            const stat = document.getElementById('upStatus');
            if(!name) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");

            stat.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø±ÙØ¹...";
            let url = null;

            if(file) {
                const path = `av_${user.id}_${Date.now()}.png`;
                const { error: upErr } = await client.storage.from('avatars').upload(path, file);
                if(!upErr) url = client.storage.from('avatars').getPublicUrl(path).data.publicUrl;
            }

            const { error } = await client.from('profiles').upsert({
                id: user.id, username: name, avatar_url: url, updated_at: new Date()
            });

            if(!error) {
                toggleModal('profileModal', false);
                refreshUI();
            } else {
                stat.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ØŒ Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©";
            }
        }

        async function sendAd() {
            const c = document.getElementById('cat').value;
            const t = document.getElementById('title').value;
            const d = document.getElementById('desc').value;
            if(!c || !t || !d) return alert("Ø£ÙƒÙ…Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†");

            const { error } = await client.from('ads').insert({ user_id: user.id, title: t, description: d, category: c });
            if(!error) { alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!"); toggleModal('adModal', false); }
        }

        function logout() { client.auth.signOut(); location.reload(); }
        function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        function openUserOptions() { toggleModal('optionsModal', true); }
    </script>
</body>
</html>
