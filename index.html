<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>شركة GASTS | فخامة الإعلان</title>
<!-- الخطوط -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet" />
<style>
  :root {
    --gold: #d4af37;
    --gold-light: #f9e272;
    --dark: #05080a;
    --glass: rgba(255, 255, 255, 0.05);
    --border: rgba(212, 175, 55, 0.2);
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    margin: 0; padding: 0; font-family: 'Cairo', sans-serif;
    background-color: var(--dark);
    color: #fff; min-height: 100vh;
    display: flex; flex-direction: column; overflow-x: hidden;
    background-image: 
      radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.05) 0%, transparent 40%),
      radial-gradient(circle at 80% 70%, rgba(26, 42, 68, 0.3) 0%, transparent 40%);
  }
  /* خلفية السديم */
  .nebula-bg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1;
    background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
    overflow: hidden;
  }
  .nebula-bg::after {
    content: "";
    position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    animation: rotateBG 180s linear infinite;
    opacity: 0.3;
  }
  @keyframes rotateBG {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  /* بطاقة التوثيق */
  .license-wrapper {
    padding: 20px; display: flex; justify-content: center;
  }
  .license-card {
    background: var(--glass);
    backdrop-filter: blur(15px);
    border: 1px solid var(--border);
    padding: 8px 20px; border-radius: 100px;
    display: flex; align-items: center; gap: 12px;
    transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }
  .license-card:hover { border-color: var(--gold); transform: translateY(-2px); }
  /* الهيدر */
  header {
    text-align: center; padding: 40px 20px;
  }
  .logo-container {
    display: inline-block; position: relative;
  }
  .diamond-icon {
    width: 80px; height: 80px;
    background: linear-gradient(135deg, var(--gold), #fff, var(--gold));
    background-size: 200% 200%;
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
    color: #000; font-weight: 900; font-size: 35px; animation: shimmer 3s infinite;
  }
  .logo-text {
    font-size: clamp(50px, 15vw, 90px);
    font-weight: 900; margin: 0; line-height: 1;
    background: linear-gradient(to bottom, #fff 40%, var(--gold) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
  }
  /* المحتوى الرئيسي */
  .main-content {
    flex: 1; display: flex; flex-direction: column; align-items: center; padding: 0 20px; text-align: center;
  }

  /* تصميم مخصص لتسجيل الدخول و إنشاء حساب بشكل جذاب */
  .auth-container {
    margin-top: 30px;
    width: 100%;
    max-width: 400px;
    background: rgba(255,255,255,0.02);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    backdrop-filter: blur(10px);
  }
  .auth-title {
    font-size: 24px; font-weight: bold; margin-bottom: 15px; color: var(--gold);
    text-align: center;
  }
  .auth-input {
    width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color:#fff;
  }
  .auth-btn {
    width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--gold); color: #000; font-weight: bold; cursor:pointer; font-size: 16px;
    transition: background 0.3s;
  }
  .auth-btn:hover { background: #bfa044; }

  /* مربع تيك توك */
  .btn-tiktok {
    background: #fff; color: #000; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 800;
    display: flex; align-items: center; gap: 10px; transition: 0.3s; box-shadow: 0 0 20px rgba(255,255,255,0.1); margin-top: 20px;
  }
  .btn-tiktok:hover {
    transform: scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.3);
  }

  /* إعلاناتي بعد الدخول */
  #ads {
    display: none;
    margin-top: 30px;
    width: 100%;
    max-width: 800px;
  }
  #ads h2 {
    color: var(--gold);
    margin-bottom: 15px;
  }
  #ad-list {
    margin-top: 15px;
  }
  /* نموذج نشر إعلان */
  #adFormContainer {
    display: none;
    background: rgba(255,255,255,0.02);
    padding: 20px;
    border-radius: 15px;
    margin-top: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }
  #adFormContainer input, #adFormContainer textarea, #adFormContainer select {
    width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color:#fff;
  }
  #adFormContainer button {
    width: 48%; padding: 12px; border: none; border-radius: 10px; background: var(--gold); color: #000; font-weight: bold; cursor:pointer; font-size: 14px;
    margin-right: 4%;
  }
  #adFormContainer button:hover { background:#bfa044; }

  /* الدردشة */
#chat {
  display:none; margin-top:30px; width:100%; max-width:800px; background: rgba(255,255,255,0.02); padding:20px; border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,0.4);
}
#messages {
  height:300px; overflow-y:auto; background:#111; padding:10px; border-radius:10px; margin-bottom:10px;
}
#chat-input {
  width: calc(100% - 80px);
  padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); color:#fff;
}
#send-btn {
  padding:12px 20px; border:none; border-radius:10px; background: var(--gold); color:#000; font-weight:bold; cursor:pointer; margin-left:10px;
}
#send-btn:hover { background:#bfa044; }
  /* العناصر الأخرى تبقى على نفس حالها */
</style>
</head>
<body>

<!-- خلفية السديم -->
<div class="nebula-bg"></div>

<!-- بطاقة التوثيق -->
<div class="license-wrapper">
  <div class="license-card">
    <img src="https://cdn-icons-png.flaticon.com/512/9745/9745265.png" width="28" alt="Verified" />
    <div>
      <div style="font-size: 10px; opacity: 0.6;">ترخيص معتمد</div>
      <div style="font-size: 13px; font-weight: bold; color: var(--gold);">وثيقة عمل حر حكومية</div>
    </div>
  </div>
</div>

<!-- الهيدر -->
<header>
  <div class="logo-container">
    <div class="diamond-icon">G</div>
    <span style="color: var(--gold); letter-spacing: 8px; font-size: 12px; font-weight: bold;">LUXURY AGENCY</span>
    <h1 class="logo-text">GASTS</h1>
  </div>
</header>

<!-- شريط التنقل -->
<div id="navbar" style="text-align:center; margin-top:20px; display:flex; justify-content: center; gap:10px;">
  <button onclick="showSection('login')">تسجيل الدخول</button>
  <button onclick="showSection('register')">إنشاء حساب</button>
  <button onclick="logout()" id="logoutBtn" style="display:none;">تسجيل الخروج</button>
  <button onclick="showSection('profile')">ملفي</button>
  <button onclick="showSection('ads')">إعلاناتي</button>
  <button onclick="showSection('chat')">الدردشة</button>
</div>

<!-- المحتوى الرئيسي -->
<div class="main-content" style="margin-top:30px; width:100%; display:flex; flex-direction:column; align-items:center;">

  <!-- تسجيل الدخول -->
  <div id="login" class="auth-container">
    <div class="auth-title">تسجيل الدخول</div>
    <input class="auth-input" type="email" id="loginEmail" placeholder="البريد الإلكتروني" />
    <input class="auth-input" type="password" id="loginPassword" placeholder="كلمة المرور" />
    <button class="auth-btn" onclick="loginUser()">دخول</button>
  </div>

  <!-- إنشاء حساب -->
  <div id="register" class="auth-container" style="display:none;">
    <div class="auth-title">إنشاء حساب</div>
    <input class="auth-input" type="text" id="regName" placeholder="اسم المستخدم" />
    <input class="auth-input" type="email" id="regEmail" placeholder="البريد الإلكتروني" />
    <input class="auth-input" type="password" id="regPassword" placeholder="كلمة المرور" />
    <button class="auth-btn" onclick="registerUser()">تسجيل</button>
  </div>

  <!-- حساب المستخدم بعد تسجيل الدخول -->
  <div id="profile" style="display:none; width:100%; max-width:500px; padding:20px; background: rgba(255,255,255,0.02); border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,0.4);">
    <h3 style="color:var(--gold); text-align:center;">حسابك</h3>
    <div style="margin-top:10px; text-align:center;">
      <div style="margin-bottom:10px;">اسمك: <span id="userNameDisplay"></span></div>
      <div style="margin-bottom:10px;">البريد: <span id="userEmailDisplay"></span></div>
      <div style="margin-bottom:10px;">صورة الشخصي (اختياري):</div>
      <input type="file" id="avatarUpload" style="margin-bottom:10px;"/>
      <button onclick="updateProfile()" style="background:var(--gold); color:#000; padding:10px; border:none; border-radius:10px; cursor:pointer;">حفظ التعديلات</button>
    </div>
  </div>

  <!-- إعلانات المستخدم -->
  <div id="ads" style="display:none; width:100%; max-width:800px; padding:20px;">
    <h2>إعلاناتي</h2>
    <div style="margin-bottom:10px;">
      <select id="categoryFilter" onchange="filterAds()" style="width:100%; padding:10px; border-radius:10px; border:none; background:rgba(255,255,255,0.1); color:#fff;">
        <option value="">كل التصنيفات</option>
        <option value="سيارات">سيارات</option>
        <option value="عقارات">عقارات</option>
        <option value="أجهزة">أجهزة</option>
        <option value="أثاث">أثاث</option>
        <option value="أراضي">أراضي</option>
      </select>
    </div>
    <button onclick="showAdForm()" style="background:var(--gold); color:#000; padding:10px; border:none; border-radius:10px; cursor:pointer; margin-bottom:20px;">نشر إعلان جديد</button>
    <div id="ad-list" style="margin-top:10px;"></div>
  </div>

  <!-- نموذج نشر إعلان -->
  <div id="adFormContainer" style="display:none; margin-top:20px;">
    <h3 style="color: var(--gold); text-align:center;">نشر إعلان</h3>
    <input id="adTitle" placeholder="عنوان الإعلان" />
    <textarea id="adDesc" placeholder="وصف الإعلان" style="width:100%; height:80px; margin-bottom:10px; border-radius:10px; padding:10px; border:none; background:rgba(255,255,255,0.1); color:#fff;"></textarea>
    <select id="adCategory" style="width:100%; padding:10px; border-radius:10px; border:none; background:rgba(255,255,255,0.1); color:#fff; margin-bottom:10px;">
      <option value="سيارات">سيارات</option>
      <option value="عقارات">عقارات</option>
      <option value="أجهزة">أجهزة</option>
      <option value="أثاث">أثاث</option>
      <option value="أراضي">أراضي</option>
    </select>
    <input type="file" id="adImage" style="margin-bottom:10px;"/>
    <div style="display:flex; justify-content: space-between;">
      <button onclick="saveAd()" style="background:var(--gold); padding:10px; border:none; border-radius:10px; cursor:pointer;">حفظ</button>
      <button onclick="hideAdForm()" style="background:#999; padding:10px; border:none; border-radius:10px; cursor:pointer;">إلغاء</button>
    </div>
  </div>

  <!-- الدردشة -->
  <div id="chat" style="display:none; width:100%; max-width:800px; padding:20px;">
    <h2 style="color:var(--gold); text-align:center;">الدردشة</h2>
    <div id="messages" style="height:300px; overflow-y:auto; background:#111; padding:10px; border-radius:10px; margin-bottom:10px;"></div>
    <div style="display:flex; gap:10px;">
      <input type="text" id="chatInput" placeholder="اكتب رسالتك..." style="flex:1; padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); color:#fff;"/>
      <button id="send-btn" onclick="sendMessage()">إرسال</button>
    </div>
  </div>

</div>

<!-- سكربتات -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
<script>
  // إعداد الاتصال
  const supabaseUrl = 'https://hdyqcgsrjnciamsyeyla.supabase.co';
  const supabaseKey = 'sb_publishable_tlwDSDSqkIpBdKGe_oA4Gg_twuI4nJC';
  const supabase = createClient(supabaseUrl, supabaseKey);
  let currentUser = null;
  let chatInterval = null;

  // عرض الأقسام
function showSection(section) {
  document.querySelectorAll('.main-content > div').forEach(div => {
    if (div.id === section) div.style.display='block';
    else div.style.display='none';
  });
  if (section==='login' || section==='register') return;
  if (section==='profile' || section==='ads') {
    loadUserData();
  }
  if (section==='chat') {
    loadMessages();
  }
}

// تسجيل الدخول
async function loginUser() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const { user, error } = await supabase.auth.signIn({ email, password });
  if (error) { alert(error.message); return; }
  currentUser = user;
  document.getElementById('logoutBtn').style.display='inline-block';
  showSection('profile');
  showSection('ads');
  loadUserData();
}

// تسجيل حساب جديد
async function registerUser() {
  const name = prompt("ادخل اسمك:");
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;
  const { user, error } = await supabase.auth.signUp({ email, password });
  if (error) { alert(error.message); return; }
  await supabase.from('profiles').insert([{ id: user.id, name }]);
  alert('تم التسجيل، سجل الدخول.');
  showSection('login');
}

// تسجيل الخروج
async function logout() {
  await supabase.auth.signOut();
  currentUser = null;
  document.getElementById('logoutBtn').style.display='none';
  showSection('login');
}

// عند تغير الحالة
supabase.auth.onAuthStateChange(async (event, session) => {
  if (session && session.user) {
    currentUser = session.user;
    document.getElementById('logoutBtn').style.display='inline-block';
    showSection('profile');
    showSection('ads');
    loadUserData();
  }
});

// تحميل بيانات المستخدم
async function loadUserData() {
  if (!currentUser) return;
  const { data } = await supabase
    .from('profiles')
    .select('name, avatar_url')
    .eq('id', currentUser.id)
    .single();
  if (data) {
    document.getElementById('userNameDisplay').innerText = data.name || '';
    document.getElementById('userEmailDisplay').innerText = currentUser.email || '';
  }
}

// تحديث الملف الشخصي
async function updateProfile() {
  const name = document.getElementById('userNameDisplay').innerText;
  const avatarFile = document.getElementById('avatarUpload').files[0];
  let avatarUrl = null;
  if (avatarFile) {
    const { data, error } = await supabase.storage
      .from('images')
      .upload(`profiles/${currentUser.id}/${avatarFile.name}`, avatarFile);
    if (error) { alert(error.message); return; }
    avatarUrl = data.Key;
  }
  await supabase.from('profiles').upsert({ id: currentUser.id, name, avatar_url: avatarUrl });
  alert('تم تحديث الحساب');
  loadUserData();
}

// عرض نموذج نشر إعلان
function showAdForm() {
  document.getElementById('adFormContainer').style.display='block';
}
function hideAdForm() {
  document.getElementById('adFormContainer').style.display='none';
}

// حفظ الإعلان
async function saveAd() {
  const title = document.getElementById('adTitle').value;
  const desc = document.getElementById('adDesc').value;
  const category = document.getElementById('adCategory').value;
  const imageFile = document.getElementById('adImage').files[0];
  if (!title || !desc || !imageFile) { alert('املأ جميع الحقول ورفع الصورة'); return; }

  const { data, error } = await supabase.storage
    .from('images')
    .upload(`ads/${currentUser.id}/${imageFile.name}`, imageFile);
  if (error) { alert(error.message); return; }
  const imageUrl = data.Key;

  await supabase.from('ads').insert([{
    user_id: currentUser.id,
    title, desc, category, image_url: imageUrl,
    created_at: new Date()
  }]);
  alert('تم نشر الإعلان');
  document.getElementById('adTitle').value='';
  document.getElementById('adDesc').value='';
  document.getElementById('adImage').value='';
  hideAdForm();
  loadUserAds();
}

// تحميل إعلانات المستخدم
async function loadUserAds() {
  const { data } = await supabase
    .from('ads')
    .select('*')
    .eq('user_id', currentUser.id);
  const container = document.getElementById('ad-list');
  container.innerHTML='';
  // تصفية حسب الفلتر
  const filterVal = document.getElementById('categoryFilter').value;
  const filteredData = filterVal ? data.filter(ad => ad.category===filterVal) : data;
  filteredData.forEach(ad => {
    const div = document.createElement('div');
    div.className='ad-item';
    const imageUrl = supabase.storage.from('images').getPublicUrl(ad.image_url).publicURL;
    div.innerHTML=`
      <h4>${ad.title}</h4>
      <img src="${imageUrl}" style="width:150px; border-radius:8px; margin-bottom:10px;" />
      <p>الفئة: ${ad.category}</p>
      <p>${ad.desc}</p>
      <button onclick="deleteAd('${ad.id}')">حذف</button>
      <button onclick="editAd('${ad.id}', '${ad.title}', '${ad.desc}', '${ad.category}', '${ad.image_url}')">تعديل</button>
    `;
    document.getElementById('ad-list').appendChild(div);
  });
}

function filterAds() {
  loadUserAds();
}

// حذف إعلان
async function deleteAd(id) {
  await supabase.from('ads').delete().eq('id', id);
  loadUserAds();
}

// تحرير إعلان
function editAd(id, title, desc, category, imageUrl) {
  const newTitle=prompt('تعديل العنوان', title);
  const newDesc=prompt('تعديل الوصف', desc);
  const newCategory=prompt('تعديل الفئة', category);
  if (newTitle && newDesc && newCategory) {
    supabase
    .from('ads')
    .update({ title: newTitle, desc: newDesc, category: newCategory })
    .eq('id', id)
    .then(() => loadUserAds());
  }
}

// الدردشة
async function loadMessages() {
  if (chatInterval) clearInterval(chatInterval);
  document.getElementById('messages').innerHTML='';
  chatInterval=setInterval(async ()=> {
    const { data }= await supabase
      .from('messages')
      .select('*')
      .order('created_at', { ascending:true });
    const container=document.getElementById('messages');
    container.innerHTML='';
    data.forEach(msg => {
      const msgDiv=document.createElement('div');
      msgDiv.className='message';
      msgDiv.innerHTML=`<strong>${msg.sender_name}:</strong> ${msg.message}`;
      container.appendChild(msgDiv);
    });
  }, 3000);
}
async function sendMessage() {
  const msg=document.getElementById('chatInput').value;
  if (!msg || !currentUser) return;
  await supabase.from('messages').insert([
    {
      sender_id: currentUser.id,
      sender_name: (await supabase.from('profiles').select('name').eq('id', currentUser.id).single()).data.name,
      message: msg,
      created_at: new Date()
    }
  ]);
  document.getElementById('chatInput').value='';
}

// عند تحميل الصفحة
window.onload = () => {
  const user = supabase.auth.user();
  if (user) {
    currentUser=user; 
    document.getElementById('logoutBtn').style.display='inline-block';
    showSection('profile');
    showSection('ads');
    loadUserData();
  }
};
</script>
</body>
</html>
