<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>شركة GASTS | فخامة الإعلان</title>
<!-- الخطوط -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet" />
<style>
  :root {
    --gold: #d4af37;
    --gold-light: #f9e272;
    --dark: #05080a;
    --glass: rgba(255, 255, 255, 0.05);
    --border: rgba(212, 175, 55, 0.2);
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    margin: 0; padding: 0; font-family: 'Cairo', sans-serif;
    background-color: var(--dark);
    color: #fff; min-height: 100vh;
    display: flex; flex-direction: column; overflow-x: hidden;
    background-image: 
      radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.05) 0%, transparent 40%),
      radial-gradient(circle at 80% 70%, rgba(26, 42, 68, 0.3) 0%, transparent 40%);
  }
  /* خلفية السديم */
  .nebula-bg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1;
    background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
    overflow: hidden;
  }
  .nebula-bg::after {
    content: "";
    position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    animation: rotateBG 180s linear infinite;
    opacity: 0.3;
  }
  @keyframes rotateBG {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  /* بطاقة التوثيق */
  .license-wrapper {
    padding: 20px; display: flex; justify-content: center;
  }
  .license-card {
    background: var(--glass);
    backdrop-filter: blur(15px);
    border: 1px solid var(--border);
    padding: 8px 20px; border-radius: 100px;
    display: flex; align-items: center; gap: 12px;
    transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }
  .license-card:hover { border-color: var(--gold); transform: translateY(-2px); }
  /* الهيدر */
  header {
    text-align: center; padding: 40px 20px;
  }
  .logo-container {
    display: inline-block; position: relative;
  }
  .diamond-icon {
    width: 80px; height: 80px;
    background: linear-gradient(135deg, var(--gold), #fff, var(--gold));
    background-size: 200% 200%;
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
    color: #000; font-weight: 900; font-size: 35px; animation: shimmer 3s infinite;
  }
  .logo-text {
    font-size: clamp(50px, 15vw, 90px);
    font-weight: 900; margin: 0; line-height: 1;
    background: linear-gradient(to bottom, #fff 40%, var(--gold) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
  }
  /* المحتوى الرئيسي */
  .main-content {
    flex: 1; display: flex; flex-direction: column; align-items: center; padding: 0 20px; text-align: center;
  }
  .hero-desc {
    max-width: 600px; color: rgba(255,255,255,0.7); font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px;
  }
  /* زر تيك توك */
  .btn-tiktok {
    background: #fff; color: #000; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 800;
    display: flex; align-items: center; gap: 10px; transition: 0.3s; box-shadow: 0 0 20px rgba(255,255,255,0.1); margin-bottom: 40px;
  }
  .btn-tiktok:hover {
    transform: scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.3);
  }
  /* كرت قريباً */
  .coming-soon-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    border: 1px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(20px); padding: 40px; border-radius: 30px; max-width: 500px; width: 100%; margin-bottom: 50px; position: relative; overflow: hidden;
  }
  .coming-soon-card::before {
    content: "";
    position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
    animation: sweep 5s infinite;
  }
  @keyframes sweep {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: 100%; }
  }
  /* الفوتر */
  footer {
    background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); padding: 40px 20px; border-top: 1px solid var(--border);
  }
  .footer-grid {
    max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; align-items: center;
  }
  .contact-item {
    color: #fff; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; padding: 15px; border-radius: 15px; transition: 0.3s; background: rgba(255,255,255,0.03); border: 1px solid var(--border);
  }
  .contact-item:hover {
    background: rgba(212, 175, 55, 0.1); color: var(--gold);
  }
  /* أنيميشن */
  @keyframes shimmer {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  @keyframes sweep {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: 100%; }
  }
  /* تحسينات الشاشة */
  @media (min-width: 768px) {
    .license-wrapper { position: absolute; top: 30px; left: 30px; }
    header { padding: 80px 20px 40px; }
  }

  /* أنماط إضافية للموديلات الوظيفية */
  #auth-overlay {
    position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7);
    display:flex; justify-content:center; align-items:center; z-index:9999;
  }
  #auth-box {
    background:#222; padding:20px; border-radius:10px; width:300px; max-width:90%;
    position:relative;
  }
  #auth-box button.close { position:absolute; top:10px; right:10px; background:none; border:none; font-size:20px; cursor:pointer; color:#fff; }

  /* نماذج الإدخال */
  input[type="text"], input[type="email"], input[type="password"], textarea, select {
    width:100%; padding:8px; margin-bottom:10px; border-radius:5px; border:none;
  }
</style>
</head>
<body>

<!-- خلفية السديم -->
<div class="nebula-bg"></div>

<!-- بطاقة التوثيق -->
<div class="license-wrapper">
  <div class="license-card">
    <img src="https://cdn-icons-png.flaticon.com/512/9745/9745265.png" width="28" alt="Verified" />
    <div>
      <div style="font-size: 10px; opacity: 0.6;">ترخيص معتمد</div>
      <div style="font-size: 13px; font-weight: bold; color: var(--gold);">وثيقة عمل حر حكومية</div>
    </div>
  </div>
</div>

<!-- الهيدر -->
<header>
  <div class="logo-container">
    <div class="diamond-icon">G</div>
    <span style="color: var(--gold); letter-spacing: 8px; font-size: 12px; font-weight: bold;">LUXURY AGENCY</span>
    <h1 class="logo-text">GASTS</h1>
  </div>
</header>

<!-- شريط التنقل -->
<div id="navbar">
  <button onclick="showSection('login')">تسجيل الدخول</button>
  <button onclick="showSection('register')">إنشاء حساب</button>
  <button onclick="logout()" id="logoutBtn" style="display:none;">تسجيل الخروج</button>
  <button onclick="showSection('profile')">ملفي</button>
  <button onclick="showSection('ads')">إعلاناتي</button>
  <button onclick="showSection('chat')">الدردشة</button>
</div>

<!-- المحتوى الرئيسي -->
<div class="main-content">

  <!-- تسجيل الدخول -->
  <div id="login" style="display:none;">
    <h2>تسجيل الدخول</h2>
    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" />
    <input type="password" id="loginPassword" placeholder="كلمة المرور" />
    <button onclick="loginUser()">دخول</button>
  </div>

  <!-- إنشاء حساب -->
  <div id="register" style="display:none;">
    <h2>إنشاء حساب</h2>
    <input type="text" id="regName" placeholder="اسم المستخدم" />
    <input type="email" id="regEmail" placeholder="البريد الإلكتروني" />
    <input type="password" id="regPassword" placeholder="كلمة المرور" />
    <button onclick="registerUser()">تسجيل</button>
  </div>

  <!-- الملف الشخصي -->
  <div id="profile" style="display:none;">
    <h2>ملفي الشخصي</h2>
    <input type="text" id="profileName" placeholder="اسم المستخدم" />
    <input type="file" id="profileAvatar" />
    <button onclick="updateProfile()">حفظ التعديلات</button>
  </div>

  <!-- الإعلانات -->
  <div id="ads" style="display:none;">
    <h2>إعلاناتي</h2>
    <div>
      <select id="categoryFilter" onchange="filterAds()">
        <option value="">كل التصنيفات</option>
        <option value="سيارات">سيارات</option>
        <option value="عقارات">عقارات</option>
        <option value="أجهزة">أجهزة</option>
        <option value="أثاث">أثاث</option>
        <option value="أراضي">أراضي</option>
      </select>
    </div>
    <button onclick="showAdForm()">نشر إعلان جديد</button>
    <div id="ad-list"></div>
  </div>

  <!-- نموذج نشر إعلان -->
  <div id="adFormContainer" style="display:none; padding:20px; background:#222; border-radius:10px; margin:20px 0;">
    <h3>نشر إعلان</h3>
    <input type="text" id="adTitle" placeholder="عنوان الإعلان" />
    <textarea id="adDesc" placeholder="وصف الإعلان"></textarea>
    <select id="adCategory">
      <option value="سيارات">سيارات</option>
      <option value="عقارات">عقارات</option>
      <option value="أجهزة">أجهزة</option>
      <option value="أثاث">أثاث</option>
      <option value="أراضي">أراضي</option>
    </select>
    <input type="file" id="adImage" />
    <button onclick="saveAd()">حفظ</button>
    <button onclick="hideAdForm()">إلغاء</button>
  </div>

  <!-- الدردشة -->
  <div id="chat" style="display:none;">
    <h2>الدردشة</h2>
    <div id="messages" style="height:300px; overflow-y:auto; background:#111; padding:10px; border-radius:10px;"></div>
    <input type="text" id="chatInput" placeholder="اكتب رسالتك..." />
    <button onclick="sendMessage()">إرسال</button>
  </div>

</div>

<!-- سكربتات -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
<script>
  // إعداد الاتصال
  const supabaseUrl = 'https://hdyqcgsrjnciamsyeyla.supabase.co';
  const supabaseKey = 'sb_publishable_tlwDSDSqkIpBdKGe_oA4Gg_twuI4nJC';
  const supabase = createClient(supabaseUrl, supabaseKey);
  let currentUser = null;
  let chatInterval;

  // عرض الأقسام
function showSection(section) {
  document.querySelectorAll('div[id^=""]').forEach(div => {
    if (div.id === section) div.style.display='block';
    else div.style.display='none';
  });
  if (section === 'login' || section === 'register') return;
  if (section === 'profile' || section==='ads') loadUserData();
  if (section==='chat') { loadMessages(); }
}

// تسجيل الدخول
async function loginUser() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const { user, error } = await supabase.auth.signIn({ email, password });
  if (error) { alert(error.message); return; }
  currentUser = user;
  document.getElementById('logoutBtn').style.display='inline-block';
  showSection('profile');
  showSection('ads');
  loadUserData();
}

// تسجيل حساب
async function registerUser() {
  const name = document.getElementById('regName').value;
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;
  const { user, error } = await supabase.auth.signUp({ email, password });
  if (error) { alert(error.message); return; }
  await supabase.from('profiles').insert([{ id: user.id, name }]);
  alert('تم التسجيل، سجل الدخول.');
  showSection('login');
}

// تسجيل الخروج
async function logout() {
  await supabase.auth.signOut();
  currentUser = null;
  document.getElementById('logoutBtn').style.display='none';
  showSection('login');
}

// عند دخول المستخدم
supabase.auth.onAuthStateChange(async (event, session) => {
  if (session && session.user) {
    currentUser = session.user;
    document.getElementById('logoutBtn').style.display='inline-block';
    showSection('profile');
    showSection('ads');
    loadUserData();
  }
});

// تحميل البيانات الشخصية
async function loadUserData() {
  if (!currentUser) return;
  const { data } = await supabase
    .from('profiles')
    .select('name, avatar_url')
    .eq('id', currentUser.id)
    .single();
  if (data) {
    document.getElementById('profileName').value = data.name || '';
  }
  loadUserAds();
}

// تحديث الملف الشخصي
async function updateProfile() {
  const name = document.getElementById('profileName').value;
  const avatarFile = document.getElementById('profileAvatar').files[0];
  let avatarUrl = null;
  if (avatarFile) {
    const { data, error } = await supabase.storage
      .from('images')
      .upload(`profiles/${currentUser.id}/${avatarFile.name}`, avatarFile);
    if (error) { alert(error.message); return; }
    avatarUrl = data.Key;
  }
  await supabase.from('profiles').upsert({ id: currentUser.id, name, avatar_url: avatarUrl });
  alert('تم تحديث الملف');
  loadUserData();
}

// عرض نموذج نشر إعلان
function showAdForm() {
  document.getElementById('adFormContainer').style.display='block';
}
function hideAdForm() {
  document.getElementById('adFormContainer').style.display='none';
}

// حفظ الإعلان
async function saveAd() {
  const title = document.getElementById('adTitle').value;
  const desc = document.getElementById('adDesc').value;
  const category = document.getElementById('adCategory').value;
  const imageFile = document.getElementById('adImage').files[0];
  if (!title || !desc || !imageFile) { alert('املأ جميع الحقول ورفع الصورة'); return; }

  const { data, error } = await supabase.storage
    .from('images')
    .upload(`ads/${currentUser.id}/${imageFile.name}`, imageFile);
  if (error) { alert(error.message); return; }
  const imageUrl = data.Key;

  await supabase.from('ads').insert([{
    user_id: currentUser.id,
    title, desc, category, image_url: imageUrl,
    created_at: new Date()
  }]);
  alert('تم نشر الإعلان');
  document.getElementById('adTitle').value='';
  document.getElementById('adDesc').value='';
  document.getElementById('adImage').value='';
  hideAdForm();
  loadUserAds();
}

// تحميل إعلانات المستخدم
async function loadUserAds() {
  const { data } = await supabase
    .from('ads')
    .select('*')
    .eq('user_id', currentUser.id);
  const container = document.getElementById('ad-list');
  container.innerHTML='';
  if (!data) return;
  // تصفية حسب الفلتر
  const filterVal = document.getElementById('categoryFilter').value;
  const filteredData = filterVal ? data.filter(ad => ad.category===filterVal) : data;
  filteredData.forEach(ad => {
    const div = document.createElement('div');
    div.className='ad-item';
    const imageUrl = supabase.storage.from('images').getPublicUrl(ad.image_url).publicURL;
    div.innerHTML=`
      <h4>${ad.title}</h4>
      <img src="${imageUrl}" style="width:150px; border-radius:8px; margin-bottom:10px;" />
      <p>الفئة: ${ad.category}</p>
      <p>${ad.desc}</p>
      <button onclick="deleteAd('${ad.id}')">حذف</button>
      <button onclick="editAd('${ad.id}', '${ad.title}', '${ad.desc}', '${ad.category}', '${ad.image_url}')">تعديل</button>
    `;
    document.getElementById('ad-list').appendChild(div);
  });
}

function filterAds() {
  loadUserAds();
}

// حذف إعلان
async function deleteAd(id) {
  await supabase.from('ads').delete().eq('id', id);
  loadUserAds();
}

// تحرير إعلان
function editAd(id, title, desc, category, imageUrl) {
  const newTitle=prompt('تعديل العنوان', title);
  const newDesc=prompt('تعديل الوصف', desc);
  const newCategory=prompt('تعديل الفئة', category);
  if (newTitle && newDesc && newCategory) {
    supabase
    .from('ads')
    .update({ title: newTitle, desc: newDesc, category: newCategory })
    .eq('id', id)
    .then(() => loadUserAds());
  }
}

// الدردشة
async function loadMessages() {
  if (chatInterval) clearInterval(chatInterval);
  document.getElementById('messages').innerHTML='';
  chatInterval=setInterval(async ()=> {
    const { data }= await supabase
      .from('messages')
      .select('*')
      .order('created_at', { ascending:true });
    const container=document.getElementById('messages');
    container.innerHTML='';
    data.forEach(msg => {
      const msgDiv=document.createElement('div');
      msgDiv.className='message';
      msgDiv.innerHTML=`<strong>${msg.sender_name}:</strong> ${msg.message}`;
      container.appendChild(msgDiv);
    });
  }, 3000);
}
async function sendMessage() {
  const msg=document.getElementById('chatInput').value;
  if (!msg || !currentUser) return;
  await supabase.from('messages').insert([
    {
      sender_id: currentUser.id,
      sender_name: (await supabase.from('profiles').select('name').eq('id', currentUser.id).single()).data.name,
      message: msg,
      created_at: new Date()
    }
  ]);
  document.getElementById('chatInput').value='';
}

// عند التحميل
window.onload = () => {
  const user = supabase.auth.user();
  if (user) {
    currentUser=user; 
    document.getElementById('logoutBtn').style.display='inline-block';
    showSection('profile');
    showSection('ads');
    loadUserData();
  }
};
</script>

</body>
</html>
