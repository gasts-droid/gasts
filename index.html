<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Ø±ÙƒØ© GASTS | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark: #05080a;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(212, 175, 55, 0.2);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Cairo', sans-serif; }

        body {
            margin: 0; padding: 0; background-color: var(--dark); color: #fff;
            min-height: 100vh; overflow-x: hidden;
            background-image: radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.05) 0%, transparent 40%);
        }

        .nebula-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ) */
        #userBox {
            position: fixed; top: 15px; right: 15px;
            display: none; align-items: center; gap: 10px;
            background: rgba(0, 0, 0, 0.6); padding: 6px 14px;
            border-radius: 40px; border: 1px solid var(--border);
            z-index: 1000; backdrop-filter: blur(10px);
        }

        header { text-align: center; padding: 60px 20px 40px; }
        .logo-text {
            font-size: clamp(50px, 15vw, 90px); font-weight: 900;
            background: linear-gradient(to bottom, #fff 40%, var(--gold) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 0; letter-spacing: -2px;
        }

        .main-content { display: flex; flex-direction: column; align-items: center; padding: 0 20px; text-align: center; }
        
        .btn-action {
            background: #fff; color: #000; padding: 15px 40px; border-radius: 50px;
            font-weight: 800; width: 260px; cursor: pointer; border: none;
            margin-bottom: 15px; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .btn-action:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(212, 175, 55, 0.2); }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .modal {
            display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85);
            backdrop-filter:blur(15px); z-index:9999; align-items:center; justify-content:center;
        }
        .modal-content {
            background:#0b0f14; border: 1px solid var(--border);
            padding:30px; border-radius:25px; width:90%; max-width:400px; text-align:center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        input, select, textarea {
            width:100%; padding:14px; margin-bottom:12px; border-radius:12px;
            border:1px solid rgba(255,255,255,0.1); background: #1a1f26; color: white; outline: none;
        }
        .btn-gold {
            width:100%; padding:14px; border-radius:50px; border:none; 
            background:var(--gold); font-weight:900; cursor:pointer; color: #000;
        }

        #statusMsg { font-size: 13px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="nebula-bg"></div>

    <div id="userBox">
        <img id="avatarImg" src="" width="34" height="34" style="border-radius:50%; border: 1px solid var(--gold); object-fit: cover;">
        <span id="usernameLabel" style="font-size: 14px; font-weight: 700;"></span>
    </div>

    <header>
        <div class="logo-container">
            <h1 class="logo-text">GASTS</h1>
            <p style="color: var(--gold); letter-spacing: 5px; font-size: 10px; font-weight: bold; margin-top: -10px;">LUXURY EXPERIENCE</p>
        </div>
    </header>

    <div class="main-content">
        <button id="mainAuthBtn" onclick="openLogin()" class="btn-action">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        
        <button id="addAdBtn" class="btn-action" style="display:none; background: var(--gold);" onclick="openAdModal()">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† ÙØ§Ø®Ø±</button>

        <div style="margin-top: 40px; opacity: 0.5; font-size: 12px;">Â© 2026 GASTS Agency. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold); margin-top: 0;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ GASTS</h3>
            <input id="authEmail" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input id="authPassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn-gold" onclick="authUser()">Ø¯Ø®ÙˆÙ„ / Ø§Ù†Ø¶Ù…Ø§Ù…</button>
            <div onclick="closeLogin()" style="margin-top:15px; font-size:12px; opacity:.5; cursor:pointer">Ø¥ØºÙ„Ø§Ù‚</div>
        </div>
    </div>

    <div id="profileSetup" class="modal">
      <div class="modal-content">
        <h3 style="color:var(--gold); margin-top: 0;">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
        <input id="usernameInput" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <div style="text-align: right; font-size: 11px; color: var(--gold); margin-bottom: 5px;">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:</div>
        <input type="file" id="avatarInput" accept="image/*">
        <button class="btn-gold" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="statusMsg"></div>
      </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold)">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
            <button class="btn-gold" style="background:#fff; margin-bottom:10px" onclick="openProfileEdit()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
            <button class="btn-gold" style="background:#ff4444; color:white" onclick="signOut()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            <div onclick="closeUserModal()" style="margin-top:15px; font-size:12px; opacity:.5; cursor:pointer">ØªØ±Ø§Ø¬Ø¹</div>
        </div>
    </div>

    <div id="adModal" class="modal">
      <div class="modal-content">
        <h3 style="color:var(--gold)">Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
        <select id="adCategory">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="Ø³ÙŠØ§Ø±Ø§Øª">Ø³ÙŠØ§Ø±Ø§Øª ÙØ§Ø®Ø±Ø©</option>
          <option value="Ø¹Ù‚Ø§Ø±Ø§Øª">Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ù„ÙƒÙŠØ©</option>
          <option value="Ø³Ø§Ø¹Ø§Øª">Ø³Ø§Ø¹Ø§Øª Ù†Ø§Ø¯Ø±Ø©</option>
        </select>
        <input id="adTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
        <textarea id="adDesc" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..." style="height:100px; resize: none;"></textarea>
        <button class="btn-gold" onclick="publishAd()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
        <div onclick="closeAdModal()" style="margin-top:15px; font-size:12px; opacity:.5; cursor:pointer">Ø¥Ù„ØºØ§Ø¡</div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseClient = window.supabase.createClient(
            "https://hdyqcgsrjnciamsyeyla.supabase.co",
            "sb_publishable_tlwDSDSqkIpBdKGe_oA4Gg_twuI4nJC"
        );

        let currentUser = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        (async () => {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user) {
                currentUser = user;
                await syncUI(user);
            }
        })();

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©
        async function authUser() {
            const email = document.getElementById("authEmail").value;
            const password = document.getElementById("authPassword").value;
            if (!email || !password) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„");

            let { error } = await supabaseClient.auth.signInWithPassword({ email, password });
            
            if (error) {
                const { error: signUpError } = await supabaseClient.auth.signUp({ email, password });
                if (signUpError) return alert(signUpError.message);
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯! ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.");
            }

            const { data: { user } } = await supabaseClient.auth.getUser();
            currentUser = user;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø£ÙˆÙ„ÙŠ ÙÙˆØ±Ø§Ù‹
            await supabaseClient.from('profiles').upsert({
                id: user.id,
                username: user.email.split('@')[0],
                avatar_url: null
            });

            await syncUI(user);
            closeLogin();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
        async function syncUI(user) {
            document.getElementById("mainAuthBtn").innerHTML = "ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ";
            document.getElementById("mainAuthBtn").onclick = openUserModal;
            document.getElementById("addAdBtn").style.display = "block";

            const { data: profile } = await supabaseClient
                .from('profiles')
                .select('*')
                .eq('id', user.id)
                .single();

            if (profile) {
                document.getElementById('usernameLabel').textContent = profile.username;
                document.getElementById('avatarImg').src = profile.avatar_url || 'https://i.imgur.com/8Km9tLL.png';
                document.getElementById('userBox').style.display = 'flex';
                
                // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                document.getElementById('usernameInput').value = profile.username;

                // Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ø§ ØºÙŠØ± Ø§Ø³Ù…Ù‡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù†ÙØªØ­ Ù„Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
                if (profile.username === user.email.split('@')[0]) {
                    document.getElementById("profileSetup").style.display = "flex";
                }
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Upsert + Storage)
        async function saveProfile() {
            const status = document.getElementById("statusMsg");
            status.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙØ§Ø®Ø±...";
            status.style.color = "#d4af37";

            const username = document.getElementById("usernameInput").value.trim();
            const file = document.getElementById("avatarInput").files[0];
            if (!username) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");

            let avatarUrl = null;

            if (file) {
                const fileExt = file.name.split('.').pop();
                const path = `${currentUser.id}.${fileExt}`;
                await supabaseClient.storage.from("avatars").upload(path, file, { upsert: true });
                avatarUrl = supabaseClient.storage.from("avatars").getPublicUrl(path).data.publicUrl;
            } else {
                // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠØ±ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø©
                const { data } = await supabaseClient.from('profiles').select('avatar_url').eq('id', currentUser.id).single();
                avatarUrl = data?.avatar_url;
            }

            const { error } = await supabaseClient.from("profiles").upsert({
                id: currentUser.id,
                username: username,
                avatar_url: avatarUrl,
                updated_at: new Date()
            });

            if (!error) {
                status.textContent = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­";
                setTimeout(() => document.getElementById("profileSetup").style.display = "none", 1000);
                await syncUI(currentUser);
            }
        }

        // Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
        async function publishAd() {
            const category = document.getElementById("adCategory").value;
            const title = document.getElementById("adTitle").value;
            const desc = document.getElementById("adDesc").value;

            if (!category || !title || !desc) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†");

            const { error } = await supabaseClient.from("ads").insert({
                user_id: currentUser.id,
                title,
                description: desc,
                category
            });

            if (!error) {
                alert("âœ… ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙÙŠ GASTS");
                closeAdModal();
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
        async function signOut() {
            await supabaseClient.auth.signOut();
            currentUser = null;
            document.getElementById("userBox").style.display = "none";
            document.getElementById("addAdBtn").style.display = "none";
            document.getElementById("userModal").style.display = "none";
            document.getElementById("mainAuthBtn").innerHTML = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
            document.getElementById("mainAuthBtn").onclick = openLogin;
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ°
        function openLogin() { document.getElementById("authModal").style.display = "flex"; }
        function closeLogin() { document.getElementById("authModal").style.display = "none"; }
        function openUserModal() { document.getElementById("userModal").style.display = "flex"; }
        function closeUserModal() { document.getElementById("userModal").style.display = "none"; }
        function openProfileEdit() { closeUserModal(); document.getElementById("profileSetup").style.display = "flex"; }
        function openAdModal() { document.getElementById("adModal").style.display = "flex"; }
        function closeAdModal() { document.getElementById("adModal").style.display = "none"; }
    </script>
</body>
</html>
